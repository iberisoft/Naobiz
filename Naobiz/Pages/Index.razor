@page "/"

@inherits OwningComponentBase<AppDbContext>
@inject NavigationManager NavigationManager
@inject UserService UserService
@inject Settings Settings

<Panel Class="page-index">
    <Heading Size="HeadingSize.Is1">Home</Heading>

    <Row>
        @foreach (var item in Settings.GetDashboard(user))
        {
            <Column ColumnSize="ColumnSize.IsQuarter">
                <Card Margin="Margin.Is4.OnY">
                    <CardLink Source="@item.LinkUrl">
                        <CardImage Source="@item.ImageSource" />
                    </CardLink>
                    <CardBody>
                        <CardTitle Size="5">@item.Name</CardTitle>
                    </CardBody>
                </Card>
            </Column>
        }
    </Row>
</Panel>

@code {
    User user;

    protected override async Task OnInitializedAsync()
    {
        user = await UserService.GetCurrentAsync(Service);

        if (user != null && !await Service.GetActivities(user).AnyAsync())
        {
            NavigationManager.NavigateTo("activities");
        }
    }
}
