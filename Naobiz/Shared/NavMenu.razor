@inherits OwningComponentBase<AppDbContext>
@inject UserService UserService
@inject Settings Settings

<Bar Breakpoint="Breakpoint.Desktop" Background="Background.Dark" ThemeContrast="ThemeContrast.Dark" Margin="Margin.Is3.FromBottom">
    <Container>
        <BarToggler />
        <BarMenu>
            <BarBrand>
                <Figure Margin="Margin.Is3.FromTop">
                    <FigureImage Source="images/logo.png" />
                </Figure>
            </BarBrand>
            <BarStart>
                <BarLink To="">Home</BarLink>
                @foreach (var item in Settings.GetDashboard(user))
                {
                    <BarLink To="@item.LinkUrl" Match="Match.Prefix">@item.Name</BarLink>
                }
                @if (user != null)
                {
                    <BarLink To="activities">Activities</BarLink>
                    <BarLink To="account">Account</BarLink>
                    @if (user.Admin)
                    {
                        <BarLink To="users">Users</BarLink>
                    }

                }
                else
                {
                    <BarLink To="login">Login</BarLink>
                }
            </BarStart>
            <BarEnd>
                @if (user != null)
                {
                    <Blazorise.Text Color="TextColor.White50" Margin="Margin.Is2">Hello @user?.Name?.Split()[0]!</Blazorise.Text>
                    <BarLink To="_logout">Logout</BarLink>
                }
            </BarEnd>
        </BarMenu>
    </Container>
</Bar>

@code {
    User user;

    protected override async Task OnInitializedAsync()
    {
        user = await UserService.GetCurrentAsync(Service);
    }
}
