@inherits OwningComponentBase<AppDbContext>
@inject UserService UserService
@inject Settings Settings

<Bar Breakpoint="Breakpoint.Desktop" Background="Background.Dark" ThemeContrast="ThemeContrast.Dark" Margin="Margin.Is3.FromBottom">
    <Container>
        <BarToggler />
        <BarMenu>
            <BarBrand>
                <Figure Margin="Margin.Is3.FromTop">
                    <FigureImage Source="images/logo.png" />
                </Figure>
            </BarBrand>
            <BarStart>
                <AuthorizeView>
                    <Authorized>
                        <BarLink To="">Home</BarLink>
                        @foreach (var item in Settings.Dashboard)
                        {
                            <BarLink To="@item.LinkUrl" Match="Match.Prefix">@item.Name</BarLink>
                        }
                        <BarLink To="activities">Activities</BarLink>
                        <BarLink To="account">Account</BarLink>
                        @if (user != null && user.Admin)
                        {
                            <BarLink To="users">Users</BarLink>
                        }
                    </Authorized>
                    <NotAuthorized>
                        <BarLink To="login">Home</BarLink>
                    </NotAuthorized>
                </AuthorizeView>
            </BarStart>
            <BarEnd>
                <AuthorizeView>
                    <Authorized>
                        <Text Color="TextColor.White50" Margin="Margin.Is2">Hello @user?.Name?.Split()[0]!</Text>
                        <BarLink To="_logout">Logout</BarLink>
                    </Authorized>
                </AuthorizeView>
            </BarEnd>
        </BarMenu>
    </Container>
</Bar>

@code {
    User user;

    protected override async Task OnInitializedAsync()
    {
        user = await UserService.GetCurrentAsync(Service);
    }
}
